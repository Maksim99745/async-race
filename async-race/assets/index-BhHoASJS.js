(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();function u(s){return s!=null}function d(s){return s==null?!1:s instanceof HTMLElement}function w(s,e){return e instanceof s}var q=Object.defineProperty,F=(s,e,t)=>e in s?q(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,E=(s,e,t)=>(F(s,typeof e!="symbol"?e+"":e,t),t);class i{constructor({tag:e="div",className:t="",text:n=""},...r){E(this,"_children",[]),E(this,"_node",null);const a=document.createElement(e);a.className=t,a.textContent=n,this._node=a,r&&r.length>0&&this.appendChildren(r)}append(e){var t;this._children.push(e);const n=e.getNode();n&&((t=this._node)==null||t.appendChild(n))}appendChildren(e){e.forEach(t=>{this.append(t)})}getNode(){if(d(this._node))return this._node;throw new Error("Node is not an HTMLElement")}getChildren(){return this._children}setTextContent(e){u(this._node)&&(this._node.textContent=e)}setAttribute(e,t){var n;(n=this._node)==null||n.setAttribute(e,t)}removeAttribute(e){var t;(t=this._node)==null||t.removeAttribute(e)}toggleClass(e){var t;(t=this._node)==null||t.classList.toggle(e)}addListener(e,t){var n;(n=this._node)==null||n.addEventListener(e,t)}destroyChildren(){this._children.forEach(e=>{e.destroy()}),this._children.length=0}destroy(){var e;this.destroyChildren(),(e=this._node)==null||e.remove()}}var H=Object.defineProperty,$=(s,e,t)=>e in s?H(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,v=(s,e,t)=>($(s,typeof e!="symbol"?e+"":e,t),t);class j{constructor(e){v(this,"_parentNode"),v(this,"goToGarage",()=>{const t=document.querySelector(".winners-page");d(t)&&(t.style.display="none");const n=document.querySelector(".garage-page");d(n)&&(n.style.display="flex")}),v(this,"goToWinners",()=>{const t=document.querySelector(".garage-page");d(t)&&(t.style.display="none");const n=document.querySelector(".winners-page");d(n)&&(n.style.display="flex")}),this._parentNode=e}draw(){const e=new i({tag:"header"}),t=this.drawGarageButton(),n=this.drawWinnersButton();n.addListener("click",()=>this.disableManager(n,t)),t.addListener("click",()=>this.disableManager(t,n)),e.appendChildren([t,n]);const r=e.getNode();return this._parentNode.appendChild(r),r}drawGarageButton(){const e=new i({tag:"button",className:"garage-button",text:"TO GARAGE"});return e.setAttribute("disabled",""),e.addListener("click",()=>this.goToGarage()),e}drawWinnersButton(){const e=new i({tag:"button",className:"winners-button",text:"TO WINNERS"});return e.addListener("click",()=>this.goToWinners()),e}disableManager(e,t){const n=e.getNode();w(HTMLButtonElement,n)&&(n.disabled=!0);const r=t.getNode();w(HTMLButtonElement,r)&&(r.disabled=!1)}}class B{setInitial(){localStorage.setItem("AsyncRace",JSON.stringify({isRace:!1,racersStack:[]}))}setUpdatingCar(e){const t=localStorage.getItem("AsyncRace");if(u(t)){const n=JSON.parse(t);n.currentUpdating=e,localStorage.setItem("AsyncRace",JSON.stringify(n))}}getUpdatingCar(){const e=localStorage.getItem("AsyncRace");if(u(e)){const t=JSON.parse(e).currentUpdating;return console.log(t),t}}isRace(){const e=localStorage.getItem("AsyncRace");if(u(e))return JSON.parse(e).isRace}startRace(){const e=localStorage.getItem("AsyncRace");if(u(e)){const t=JSON.parse(e);t.isRace=!0,localStorage.setItem("AsyncRace",JSON.stringify(t))}}endRace(){const e=localStorage.getItem("AsyncRace");if(u(e)){const t=JSON.parse(e);t.isRace=!1,localStorage.setItem("AsyncRace",JSON.stringify(t))}}removeFinishers(){const e=localStorage.getItem("AsyncRace");if(u(e)){const t=JSON.parse(e);t.racersStack=[],localStorage.setItem("AsyncRace",JSON.stringify(t))}}addFinisher(e){const t=localStorage.getItem("AsyncRace");if(u(t)){const n=JSON.parse(t);n.racersStack.push(e),localStorage.setItem("AsyncRace",JSON.stringify(n))}}getWinnerLocalStorage(){const e=localStorage.getItem("AsyncRace");if(u(e))return JSON.parse(e).racersStack[0]}}class h{async getCars(e=1){try{return await(await fetch(`http://localhost:3000/garage?_page=${e}&_limit=7`)).json()}catch(t){console.log(t)}}async getAllCars(){try{return await(await fetch("http://localhost:3000/garage")).json()}catch(e){console.log(e)}}async getCar(e){try{return await(await fetch(`http://localhost:3000/garage/${e}`)).json()}catch(t){throw console.log(t),t}}async createCar(e,t){const n={name:e,color:t};if(u(n))try{return await fetch("http://localhost:3000/garage/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch(r){console.log(r)}}async deleteCar(e){try{return await fetch(`http://localhost:3000/garage/${e}`,{method:"DELETE"})}catch(t){console.log(t)}}async updateCar(e){const t={name:e.name,color:e.color};try{if(u(t)){const n=await fetch(`http://localhost:3000/garage/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});console.log(n)}}catch(n){console.log(n)}}async startStopEngine(e){if(u(e))try{return await(await fetch(`http://localhost:3000/engine?id=${e.id}&status=${e.status}`,{method:"PATCH"})).json()}catch(t){console.error(t)}}async drive(e){if(u(e))try{const t=await fetch(`http://localhost:3000/engine?id=${e}&status=drive`,{method:"PATCH"});if(!t.ok)throw new Error(t.statusText);return await t.json()}catch(t){throw new Error("API Error: "+t)}}async getWinners(e=1,t="id",n="ASC"){try{return await(await fetch(`http://localhost:3000/winners?_page=${e}&_limit=10&_sort=${t}&_order=${n}`)).json()}catch(r){console.log(r)}}async getAllWinners(){try{return await(await fetch("http://localhost:3000/winners")).json()}catch(e){console.log(e)}}async getWinner(e){try{const t=await fetch(`http://localhost:3000/winners/${e}`);if(!t.ok)throw console.log(t.statusText),new Error(t.statusText);return await t.json()}catch(t){throw new Error("API Error: "+t)}}async createWinner(e){if(u(e))try{return await fetch("http://localhost:3000/winners",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(t){console.log(t)}}async deleteWinner(e){try{return await fetch(`http://localhost:3000/winners/${e}`,{method:"DELETE"})}catch(t){console.log(t)}}async updateWinner(e,t){const n={wins:e.wins,time:e.time};try{u(n)&&await fetch(`http://localhost:3000/winners/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch(r){console.log(r)}}}class k{draw(){const e=new i({tag:"div",className:"cars-amount"});return this.updateCarAmount(),e}async updateCarAmount(){const e=(await new h().getAllCars()).length,t=document.querySelector(".cars-amount");d(t)&&(t.textContent=`Garage (${e})`)}}var J=Object.defineProperty,D=(s,e,t)=>e in s?J(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,G=(s,e,t)=>(D(s,typeof e!="symbol"?e+"":e,t),t);class T{constructor(e){G(this,"_color"),this._color=e}drawCar(){const e=new i({tag:"div",className:"car-container"});return e.getNode().appendChild(this.createSvg()),e}createSvg(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=document.createElementNS("http://www.w3.org/2000/svg","use");return t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","./car.svg#car"),e.classList.add("car"),e.style.fill=this._color,e.append(t),e}}class W{draw(e){return new i({tag:"div",className:"car-block__button",text:e})}}class U extends W{drawRemoveButton(){const e=this.draw("REMOVE").getNode();return e.classList.add("remove-button"),e}}var K=Object.defineProperty,V=(s,e,t)=>e in s?K(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,X=(s,e,t)=>(V(s,typeof e!="symbol"?e+"":e,t),t);class z extends W{constructor(e){super(),X(this,"_id"),this._id=e}drawSelecetButton(){const e=this.draw("SELECT").getNode();return this.selectCar(e),e.classList.add("select-button"),e}selectCar(e){e.addEventListener("click",()=>{const t=document.querySelector(".update-input");t instanceof HTMLInputElement&&(t.disabled=!1,new B().setUpdatingCar(this._id),this.selectCurentBlock(e,"updating-block"))})}selectCurentBlock(e,t){document.querySelectorAll(".car-block").forEach(r=>{r.classList.remove(t)});const n=e.closest(".car-block");u(n)&&n.classList.add(t)}}class Q{drawStartButton(){const e=new i({tag:"button",className:"car-block__button",text:"A"}),t=e.getNode();return this.disableButton(t),t.classList.add("start-button"),e}disableButton(e){e.addEventListener("click",()=>{if(e instanceof HTMLButtonElement&&e.disabled===!1){const t=e.nextElementSibling;t instanceof HTMLButtonElement&&(new B().isRace()||(t.disabled=!1),t.disabled=!1,e.disabled=!0)}})}}class Y{drawStopButton(){const e=new i({tag:"button",className:"car-block__button",text:"B"}),t=e.getNode();return t.setAttribute("disabled",""),t.classList.add("stop-button"),this.disableButton(t),e}disableButton(e){e.addEventListener("click",()=>{if(e instanceof HTMLButtonElement){const t=e.previousElementSibling;t instanceof HTMLButtonElement&&(t.disabled=!1,e.disabled=!0)}})}}var Z=Object.defineProperty,ee=(s,e,t)=>e in s?Z(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,m=(s,e,t)=>(ee(s,typeof e!="symbol"?e+"":e,t),t);class S{constructor(e,t,n){m(this,"_name"),m(this,"_color"),m(this,"_id"),m(this,"_car"),m(this,"_carSectionNode"),m(this,"_parentCarBlock"),m(this,"_removeCarBlockFromArr"),m(this,"_winnerPage"),m(this,"startCarMovement",async(r,a)=>{const o=await new h().startStopEngine({id:r,status:"started"});await this.driveAnimation(o,a,this._car)}),m(this,"isCarEverWon",async()=>{try{return await new h().getWinner(this._id),!0}catch(r){if(r==="Not Found")return!1}}),m(this,"recordWin",async r=>{const a=await this.isCarEverWon(),o=new h;if(a){const c=await o.getWinner(this._id);console.log(c);const l=c.wins+1,g=c.time,p=r.time;g>p?await o.updateWinner({wins:l,time:p},this._id):await o.updateWinner({wins:l,time:g},this._id)}else{const c={id:this._id,wins:1,time:r.time};await o.createWinner(c)}await o.getAllWinners()}),m(this,"removeButtonClickListener",()=>{this.removeThisBlock()}),this._name=e.name,this._color=e.color,this._id=e.id,this._parentCarBlock=new i({tag:"div",className:"car-block"}),this._removeCarBlockFromArr=t,this._winnerPage=n}draw(){const e=this._parentCarBlock,t=e.getNode();return this.addButtonsBlock(e),this.addCarSection(e),t}addButtonsBlock(e){const t=new i({tag:"div",className:"car-block__buttons"}),n=t.getNode(),r=new i({tag:"div",className:"car-block__name",text:this._name}),a=new z(this._id).drawSelecetButton(),o=new U().drawRemoveButton();o.addEventListener("click",this.removeButtonClickListener),n.appendChild(a),n.appendChild(o),n.appendChild(r.getNode()),e.append(t)}addCarSection(e){const t=new i({tag:"div",className:"car-section"}),n=t.getNode();this._carSectionNode=n;const r=new Q().drawStartButton(),a=r.getNode();a.addEventListener("click",()=>{this.startCarMovement(this._id,n)});const o=new Y,c=o.drawStopButton();c.getNode().addEventListener("click",()=>{o.disableButton(a),this.stopCarMovement(this._id,this._car)}),t.append(r),t.append(c),this._car=new T(this._color).drawCar(),t.append(this._car),n.appendChild(this.addFlag()),e.append(t)}async driveAnimation(e,t,n){try{const r=e.distance/e.velocity/1e3,a=t.offsetWidth-80,o=n==null?void 0:n.getNode();if(d(o)&&(o.style.left=`${a}px`,o.style.transition=`left ${r}s linear`),await await new h().drive(this._id)){const c={finisher:this._id,time:r.toFixed(2),color:this._color},l=new B;l.isRace()&&(l.addFinisher(c),await this.showWinner(c))}}catch(r){if(r instanceof Error&&r.message==="API Error: Error: Internal Server Error"){const a=n==null?void 0:n.getNode();if(d(a)){const o=window.getComputedStyle(a).getPropertyValue("left");a.style.left=o,a.style.filter="blur(5px)",a.style.transition="left 0s linear"}}}}async stopCarMovement(e,t){await new h().startStopEngine({id:e,status:"stopped"});const n=t==null?void 0:t.getNode();d(n)&&(setTimeout(()=>n.style.filter="blur(0px)",1500),n.style.left="80px",n.style.transition="left 0s linear")}addFlag(){const e=new Image;return e.src="/red-flag.png",e.classList.add("car-block__flag"),e}async removeThisBlock(){console.log(this._removeCarBlockFromArr);const e=new h;await e.deleteCar(this._id),await e.deleteWinner(this._id),this._parentCarBlock.destroy(),this._removeCarBlockFromArr(this._id),new k().updateCarAmount(),await this._winnerPage.reloadWinnersBlock()}async showWinner(e){const t=document.querySelector(".winner-block");if(d(t)&&!t.textContent){const n=new h,r={id:this._id,time:Number(e.time)};this.recordWin(r);const a=`Winner: ${(await n.getCar(e.finisher)).name} (${e.time}s)!`;t.textContent=a,await this._winnerPage.reloadWinnersBlock("time","ASC")}}}class te{draw(){return new i({tag:"button",className:"generate-button",text:"GENERATE 100 CARS"})}}var ne=Object.defineProperty,re=(s,e,t)=>e in s?ne(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,N=(s,e,t)=>(re(s,typeof e!="symbol"?e+"":e,t),t);class I{constructor(e,t,n){N(this,"_carBlocks"),N(this,"_winnerPage"),N(this,"_removeCarBlockFromArr"),this._carBlocks=e,this._removeCarBlockFromArr=t,this._winnerPage=n}draw(){const e=new i({tag:"div",className:"create-block"});return e.append(this.drawInput("create-input")),e.append(this.drawPalette("create-color-input")),e.append(this.drawCreateButton()),e}drawInput(e){const t=new i({tag:"input",className:e});return t.setAttribute("type","text"),t.setAttribute("required",""),t.setAttribute("minlength","1"),t.setAttribute("maxlength","20"),t}drawPalette(e){const t=new i({tag:"input",className:e});return t.setAttribute("type","color"),t.setAttribute("value","#ffffff"),t}drawCreateButton(){const e=new i({tag:"div",className:"create-button",text:"CREATE"});return this.createCar(e),e}createCar(e){e.getNode().addEventListener("click",async()=>{const t=document.querySelector(".create-input"),n=document.querySelector(".create-color-input");if(t instanceof HTMLInputElement&&n instanceof HTMLInputElement){const r=t.value,a=n.value;if(r.length>=1){const o=new h;await o.createCar(r,a);const c=await o.getCars(),l=c[c.length-1];this.addNewCarBlock(l),t.style.outline="",t.value=""}else t.style.outline="1px solid red"}})}addNewCarBlock(e){const t=document.querySelector(".cars-block");if(d(t)&&t.children.length<7){const n=new S(e,this._removeCarBlockFromArr,this._winnerPage);this._carBlocks.push(n),console.log(this._carBlocks);const r=n.draw();t.appendChild(r),new k().updateCarAmount()}}}var se=Object.defineProperty,ae=(s,e,t)=>e in s?se(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,C=(s,e,t)=>(ae(s,typeof e!="symbol"?e+"":e,t),t);class oe{constructor(e,t,n){C(this,"_carBlocks"),C(this,"_removeCarBlockFromArr"),C(this,"_winnerPage"),C(this,"updateCarInBlocksArr",r=>(this._carBlocks.map(a=>(a._id===r.id&&(a._name=r.name,a._color=r.color),a)),this._carBlocks=this._carBlocks.slice(),console.log(this._carBlocks),this._carBlocks)),this._carBlocks=e,this._removeCarBlockFromArr=t,this._winnerPage=n}draw(){const e=new i({tag:"div",className:"update-block"}),t=new I(this._carBlocks,this._removeCarBlockFromArr,this._winnerPage),n=t.drawInput("update-input");n.setAttribute("disabled",""),e.append(n);const r=t.drawPalette("update-color-input");return e.append(r),e.append(this.drawUpdateButton()),e}drawUpdateButton(){const e=new i({tag:"div",className:"update-button",text:"UPDATE"});return this.updateCar(e),e}updateCar(e){e.getNode().addEventListener("click",async()=>{const t=document.querySelector(".update-input"),n=document.querySelector(".update-color-input");if(t instanceof HTMLInputElement&&n instanceof HTMLInputElement){const r=t.value,a=n.value;if(!t.disabled)if(r.length>=1){const o=new B().getUpdatingCar();await new h().updateCar({name:r,color:a,id:o}),t.style.outline="",t.value="",t.disabled=!0,await this.getNewCarBlock(o)}else t.style.outline="1px solid red"}})}async getNewCarBlock(e){const t=await new h().getCar(e),n=document.querySelector(".updating-block");if(d(n)){const r=n.querySelector(".car"),a=n.querySelector(".car-block__name");console.log(t),u(r)&&d(a)&&(r.setAttribute("style",`fill: ${t.color};`),a.textContent=t.name),n.classList.remove("updating-block"),this.updateCarInBlocksArr(t)}}}var ie=Object.defineProperty,ce=(s,e,t)=>e in s?ie(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,L=(s,e,t)=>(ce(s,typeof e!="symbol"?e+"":e,t),t);class le{constructor(e,t,n){L(this,"_carBlocks"),L(this,"_removeCarBlockFromArr"),L(this,"_winnerPage"),this._carBlocks=e,this._removeCarBlockFromArr=t,this._winnerPage=n}draw(){const e=new i({tag:"div",className:"inputs-block"}),t=new I(this._carBlocks,this._removeCarBlockFromArr,this._winnerPage).draw(),n=new oe(this._carBlocks,this._removeCarBlockFromArr,this._winnerPage).draw();return e.append(t),e.append(n),e}}class M{drawCounter(){const e=new i({tag:"div",className:"pagination-counter"}),t=e.getNode();return t.textContent="Page #1",e}drawPaginationButtonsBlock(e,t){const n=new i({tag:"div",className:"pagination-buttons"});n.appendChildren(t),e.append(n)}drawPrevButton(){const e=new i({tag:"button",className:"pagination-button",text:"prev"});return e.setAttribute("disabled",""),e}async drawNextButton(e){const t=new i({tag:"button",className:"pagination-button",text:"next"});return(await new h().getAllCars()).length<=e&&t.setAttribute("disabled",""),t}}class de{draw(){const e=new i({tag:"button",className:"race-button",text:"RACE"});return this.disableButton(e.getNode()),e}disableButton(e){e.addEventListener("click",async()=>{e instanceof HTMLButtonElement&&(e.disabled=!0)})}}class ue{draw(){const e=new i({tag:"button",className:"restart-button",text:"RESTART"});return this.restart(e.getNode()),e}restart(e){e.addEventListener("click",()=>{const t=document.querySelector(".race-button");t instanceof HTMLButtonElement&&(t.disabled=!1),e instanceof HTMLButtonElement&&(e.disabled=!0)})}}var he=Object.defineProperty,we=(s,e,t)=>e in s?he(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,P=(s,e,t)=>(we(s,typeof e!="symbol"?e+"":e,t),t);class me{constructor(e){P(this,"_carBlocks"),P(this,"_restartButton"),this._carBlocks=e}draw(){const e=new i({tag:"div",className:"race-block"}),t=new de().draw();t.getNode().addEventListener("click",()=>{w(HTMLButtonElement,this._restartButton)&&(this._restartButton.disabled=!0);const o=this._carBlocks.map(c=>c.stopCarMovement(c._id,c._car));Promise.allSettled(o).then(()=>{this.startRace(this._carBlocks)}),setTimeout(()=>{u(this._restartButton)&&(this._restartButton.disabled=!0)},5e3)});const n=new ue().draw(),r=n.getNode();r instanceof HTMLButtonElement&&(this._restartButton=r);const a=this.drawWinnerBlock();return r.addEventListener("click",async()=>{this.restartGame(this._carBlocks),this.cleanWinnerBlock(a)}),e.appendChildren([t,n,a]),e}async restartGame(e){e.forEach(async t=>{await t.stopCarMovement(t._id,t._car)}),new B().endRace()}async startRace(e){const t=new B;t.startRace(),t.removeFinishers(),e.forEach(async n=>{u(n._carSectionNode)&&await n.startCarMovement(n._id,n._carSectionNode)})}drawWinnerBlock(){return new i({tag:"div",className:"winner-block"})}cleanWinnerBlock(e){const t=e.getNode();t.textContent!==""&&(t.innerText="")}}const ge=()=>{const s=["#ffffff","#FFAEBC","#A0E7E5","#B4F8C8","#FBE7C6","#74BDCB","#E7F2F8","#4EC33D","#353643","#F0C9B3"],e=Math.floor(Math.random()*s.length);return`${s[e]}`},pe=()=>{const s=["Tesla","Ford","Seat","Fiat","BMW","Chery","Lada","Dacia","KIA","Toyota"],e=["Compact","S","Comfort","Speed","Family","Off-road","4X4","Nitro","Basic","Gold"],t=Math.floor(Math.random()*s.length),n=Math.floor(Math.random()*e.length);return`${s[t]} ${e[n]}`},O=s=>new i({tag:"div",className:"page-name",text:s});var fe=Object.defineProperty,ye=(s,e,t)=>e in s?fe(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,f=(s,e,t)=>(ye(s,typeof e!="symbol"?e+"":e,t),t);class _e{constructor(e,t){f(this,"_parentNode"),f(this,"_winnerPage"),f(this,"_carBlocksArr",[]),f(this,"_currentPage",1),f(this,"_carsBlock"),f(this,"prevButtonClickListener",()=>{this._currentPage-=1,this.cleanCarBlocks(),this.addCars(this._currentPage,this._carsBlock),this.updatePaginatinCounter();const n=document.querySelector(".prev-button");this._currentPage===1&&w(HTMLButtonElement,n)&&(n.disabled=!0);const r=document.querySelector(".next-button");w(HTMLButtonElement,r)&&(r.disabled=!1);const a=document.querySelector(".race-button");w(HTMLButtonElement,a)&&(a.disabled=!1)}),f(this,"nextButtonClickListener",async()=>{this._currentPage+=1,this.cleanCarBlocks(),this.addCars(this._currentPage,this._carsBlock),this.updatePaginatinCounter();const n=document.querySelector(".prev-button");if(w(HTMLButtonElement,n)&&(n.disabled=!1),await this.isLastCarPage()){const a=document.querySelector(".next-button");w(HTMLButtonElement,a)&&(a.disabled=!0)}const r=document.querySelector(".race-button");w(HTMLButtonElement,r)&&(r.disabled=!1)}),f(this,"generateButtonListener",async()=>{for(let r=0;r<100;r+=1){const a=pe(),o=ge();await this.generateCarData(a,o)}const n=document.querySelector(".next-button");w(HTMLButtonElement,n)&&(n.disabled=!1),await new k().updateCarAmount()}),f(this,"generateCarData",async(n,r)=>{const a=new h;await a.createCar(n,r);const o=await a.getAllCars(),c=o[o.length-1];console.log(c),this.addNewCarBlock(c)}),f(this,"addCars",async(n,r)=>{(await new h().getCars(n)).forEach(a=>{const o=new S(a,this.removeCarBlockFromArr,this._winnerPage),c=o.draw();this._carBlocksArr.push(o),r==null||r.appendChild(c)})}),f(this,"removeCarBlockFromArr",n=>{console.log(n),this._carBlocksArr=this._carBlocksArr.filter(r=>r._id!==n)}),this._parentNode=e,this._winnerPage=t}async draw(){const e=new i({tag:"div",className:"garage-page"}),t=O("GARAGE");e.append(t);const n=new le(this._carBlocksArr,this.removeCarBlockFromArr,this._winnerPage).draw(),r=new te().draw();r.addListener("click",this.generateButtonListener),e.append(r);const a=new me(this._carBlocksArr).draw(),o=new k().draw(),c=new M,l=c.drawCounter();e.appendChildren([n,a,o,l]);const g=e.getNode();this.addCarsBlock(g),this._parentNode.appendChild(g);const p=c.drawPrevButton();p.getNode().classList.add("prev-button"),p.addListener("click",this.prevButtonClickListener);const b=await c.drawNextButton(7);b.addListener("click",this.nextButtonClickListener),b.getNode().classList.add("next-button"),c.drawPaginationButtonsBlock(e,[p,b])}addNewCarBlock(e){var t,n;const r=(t=this._carsBlock)==null?void 0:t.children.length;if(u(r)&&r<7){const a=new S(e,this.removeCarBlockFromArr,this._winnerPage);this._carBlocksArr.push(a);const o=a.draw();(n=this._carsBlock)==null||n.appendChild(o)}}async isLastCarPage(){const e=(await new h().getAllCars()).length,t=this._currentPage*7;return!(e-t>0)}updatePaginatinCounter(){const e=document.querySelector(".pagination-counter");d(e)&&(e.textContent=`Page #${this._currentPage}`)}cleanCarBlocks(){var e;for(this._carBlocksArr.length=0;(e=this._carsBlock)!=null&&e.firstChild;)this._carsBlock.removeChild(this._carsBlock.firstChild)}async addCarsBlock(e){const t=new i({tag:"div",className:"cars-block"}).getNode();this._carsBlock=t,this==null||this.addCars(this._currentPage,t),e.appendChild(t)}}var Be=Object.defineProperty,be=(s,e,t)=>e in s?Be(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,_=(s,e,t)=>(be(s,typeof e!="symbol"?e+"":e,t),t);class Ce{constructor(e,t){_(this,"_winnerData"),_(this,"_currentNumber"),_(this,"draw",async()=>{const n=new i({tag:"div",className:"winner__block"}),r=this.addNumberBlock(),a=await this.addCarBlock(),o=await this.addNameBlock(),c=this.addWinsBlock(),l=this.addTimeBlock();return n.appendChildren([r,a,o,c,l]),n}),_(this,"addCarBlock",async()=>{const n=new i({tag:"div",className:"winner__item"}),r=await new h().getCar(this._winnerData.id),a=new T(r.color).drawCar();return a.getNode().style.position="relative",a.getNode().style.left="0",n.append(a),n}),_(this,"addNameBlock",async()=>{const n=new i({tag:"div",className:"winner__item"}),r=await new h().getCar(this._winnerData.id);return n.getNode().textContent=r.name,n}),_(this,"addWinsBlock",()=>{const n=new i({tag:"div",className:"winner__item"});return n.getNode().textContent=String(this._winnerData.wins),n}),_(this,"addTimeBlock",()=>{const n=new i({tag:"div",className:"winner__item"}),r=n.getNode();return r.textContent=String(this._winnerData.time),r.style.width="32%",n}),this._winnerData=e,this._currentNumber=t}addNumberBlock(){const e=new i({tag:"div",className:"winner__item"});return e.getNode().textContent=String(this._currentNumber+1),e}}class x{draw(){const e=new i({tag:"div",className:"winners-amount"});return this.updateWinnersAmount(),e}async updateWinnersAmount(){const e=(await new h().getAllWinners()).length,t=document.querySelector(".winners-amount");d(t)&&(t.textContent=`Winners (${e})`)}}class ke{draw(){const e=new i({tag:"div",className:"winners-header"}),t=this.addNumberBlock(),n=this.addCarBlock(),r=this.addNameBlock();return e.appendChildren([t,n,r]),e}addNumberBlock(){return new i({tag:"div",className:"winners-header__item",text:"Number"})}addCarBlock(){return new i({tag:"div",className:"winners-header__item",text:"Car"})}addNameBlock(){return new i({tag:"div",className:"winners-header__item",text:"Name"})}addWinsBlock(){return new i({tag:"div",className:"winners-header__item",text:"Wins"})}addTimesBlock(){const e=new i({tag:"div",className:"winners-header__item",text:"Best time (secounds)"});return e.getNode().classList.add("winners-header__time"),e}}var ve=Object.defineProperty,Ne=(s,e,t)=>e in s?ve(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,y=(s,e,t)=>(Ne(s,typeof e!="symbol"?e+"":e,t),t);class Le{constructor(e,t){y(this,"_parentNode"),y(this,"_currentPage",1),y(this,"_winnerItemsBlock"),y(this,"prevButtonClickListener",()=>{this._currentPage-=1,this.cleanWinnerItemsBlock(),d(this._winnerItemsBlock)&&this.addWinners(this._currentPage,this._winnerItemsBlock),this.updatePaginatinCounter();const n=document.querySelector(".winners-prev-button");this._currentPage===1&&w(HTMLButtonElement,n)&&(n.disabled=!0);const r=document.querySelector(".winners-next-button");w(HTMLButtonElement,r)&&(r.disabled=!1)}),y(this,"reloadWinnersBlock",async(n="id",r="DESC")=>{if(this.cleanWinnerItemsBlock(),await new x().updateWinnersAmount(),d(this._winnerItemsBlock)&&this.addWinners(this._currentPage,this._winnerItemsBlock,n,r),await this.isLastCarPage()){const a=document.querySelector(".winners-next-button");w(HTMLButtonElement,a)&&(a.disabled=!0)}}),y(this,"nextButtonClickListener",async()=>{this._currentPage+=1,this.cleanWinnerItemsBlock(),d(this._winnerItemsBlock)&&this.addWinners(this._currentPage,this._winnerItemsBlock),this.updatePaginatinCounter();const n=document.querySelector(".winners-prev-button");if(console.log(n),this._currentPage!==1&&w(HTMLButtonElement,n)&&(n.disabled=!1),await this.isLastCarPage()){const r=document.querySelector(".winners-next-button");w(HTMLButtonElement,r)&&(r.disabled=!0)}}),y(this,"addWinnersBlock",async n=>{const r=new i({tag:"div",className:"winners-block"}),a=new ke,o=a.draw();r.append(o);const c=a.addWinsBlock(),l=c.getNode(),g=a.addTimesBlock(),p=g.getNode(),b=this.addWinnerItemsBlock();o.appendChildren([c,g]),g.addListener("click",()=>this.sortByTimeslistener(p,l)),c.addListener("click",()=>this.sortByWinnerslistener(l,p)),r.append(b),n.append(r)}),y(this,"sortByWinnerslistener",(n,r)=>{r.classList.remove("sort-arrow-up"),r.classList.remove("sort-arrow-down"),n.classList.toggle("wins-desc"),n.classList.contains("wins-desc")?(this.reloadWinnersBlock("wins","DESC"),n.classList.add("sort-arrow-down"),n.classList.remove("sort-arrow-up")):(this.reloadWinnersBlock("wins","ASC"),n.classList.add("sort-arrow-up"),n.classList.remove("sort-arrow-down"))}),y(this,"sortByTimeslistener",(n,r)=>{n.classList.toggle("time-desc"),r.classList.remove("sort-arrow-up"),r.classList.remove("sort-arrow-down"),n.classList.contains("time-desc")?(this.reloadWinnersBlock("time","DESC"),n.classList.add("sort-arrow-down"),n.classList.remove("sort-arrow-up")):(this.reloadWinnersBlock("time","ASC"),n.classList.add("sort-arrow-up"),n.classList.remove("sort-arrow-down"))}),y(this,"addWinnerItemsBlock",()=>{const n=new i({tag:"div",className:"winner-items-block"}),r=n.getNode();return this._winnerItemsBlock=r,this.addWinners(this._currentPage,r),n}),y(this,"addWinners",async(n,r,a="id",o="ASC")=>{const c=await new h().getWinners(n,a,o);for(let l=0;l<c.length;l++){const g=c[l];if(d(r)){const p=await(await new Ce(g,l).draw()).getNode();r.appendChild(p)}}}),this._parentNode=e,this._currentPage=t}async draw(){const e=new i({tag:"div",className:"winners-page"}),t=e.getNode();this._parentNode.appendChild(t);const n=O("WINNERS"),r=new x().draw(),a=new M,o=a.drawCounter();o.getNode().classList.add("winners-pagination-couneter"),e.appendChildren([n,r,o]),this.addWinnersBlock(e);const c=a.drawPrevButton();c.getNode().classList.add("winners-prev-button"),c.addListener("click",this.prevButtonClickListener);const l=await a.drawNextButton(10);l.getNode().classList.add("winners-next-button"),l.addListener("click",this.nextButtonClickListener),a.drawPaginationButtonsBlock(e,[c,l])}cleanWinnerItemsBlock(){if(d(this._winnerItemsBlock))for(;this._winnerItemsBlock.firstChild;)this._winnerItemsBlock.removeChild(this._winnerItemsBlock.firstChild)}updatePaginatinCounter(){const e=document.querySelector(".winners-pagination-couneter");d(e)&&(e.textContent=`Page #${this._currentPage}`)}async isLastCarPage(){const e=(await new h().getAllWinners()).length,t=this._currentPage*10;return!(e-t>0)}}const Se=1,Ae=new B;Ae.setInitial();const A=document.body,Ee=new j(A);Ee.draw();const R=new Le(A,Se);R.draw();const Pe=new _e(A,R);Pe.draw();
