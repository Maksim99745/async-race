(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=e(r);fetch(r.href,a)}})();(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();function u(s){return s!=null}function d(s){return s==null?!1:s instanceof HTMLElement}function w(s,t){return t instanceof s}var F=Object.defineProperty,q=(s,t,e)=>t in s?F(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,E=(s,t,e)=>(q(s,typeof t!="symbol"?t+"":t,e),e);class i{constructor({tag:t="div",className:e="",text:n=""},...r){E(this,"_children",[]),E(this,"_node",null);const a=document.createElement(t);a.className=e,a.textContent=n,this._node=a,r&&r.length>0&&this.appendChildren(r)}append(t){var e;this._children.push(t);const n=t.getNode();n&&((e=this._node)==null||e.appendChild(n))}appendChildren(t){t.forEach(e=>{this.append(e)})}getNode(){if(d(this._node))return this._node;throw new Error("Node is not an HTMLElement")}getChildren(){return this._children}setTextContent(t){u(this._node)&&(this._node.textContent=t)}setAttribute(t,e){var n;(n=this._node)==null||n.setAttribute(t,e)}removeAttribute(t){var e;(e=this._node)==null||e.removeAttribute(t)}toggleClass(t){var e;(e=this._node)==null||e.classList.toggle(t)}addListener(t,e){var n;(n=this._node)==null||n.addEventListener(t,e)}destroyChildren(){this._children.forEach(t=>{t.destroy()}),this._children.length=0}destroy(){var t;this.destroyChildren(),(t=this._node)==null||t.remove()}}var H=Object.defineProperty,$=(s,t,e)=>t in s?H(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,v=(s,t,e)=>($(s,typeof t!="symbol"?t+"":t,e),e);class j{constructor(t){v(this,"_parentNode"),v(this,"goToGarage",()=>{const e=document.querySelector(".winners-page");d(e)&&(e.style.display="none");const n=document.querySelector(".garage-page");d(n)&&(n.style.display="flex")}),v(this,"goToWinners",()=>{const e=document.querySelector(".garage-page");d(e)&&(e.style.display="none");const n=document.querySelector(".winners-page");d(n)&&(n.style.display="flex")}),this._parentNode=t}draw(){const t=new i({tag:"header"}),e=this.drawGarageButton(),n=this.drawWinnersButton();n.addListener("click",()=>this.disableManager(n,e)),e.addListener("click",()=>this.disableManager(e,n)),t.appendChildren([e,n]);const r=t.getNode();return this._parentNode.appendChild(r),r}drawGarageButton(){const t=new i({tag:"button",className:"garage-button",text:"TO GARAGE"});return t.setAttribute("disabled",""),t.addListener("click",()=>this.goToGarage()),t}drawWinnersButton(){const t=new i({tag:"button",className:"winners-button",text:"TO WINNERS"});return t.addListener("click",()=>this.goToWinners()),t}disableManager(t,e){const n=t.getNode();w(HTMLButtonElement,n)&&(n.disabled=!0);const r=e.getNode();w(HTMLButtonElement,r)&&(r.disabled=!1)}}class f{setInitial(){localStorage.setItem("AsyncRace",JSON.stringify({isRace:!1,racersStack:[]}))}setUpdatingCar(t){const e=localStorage.getItem("AsyncRace");if(u(e)){const n=JSON.parse(e);n.currentUpdating=t,localStorage.setItem("AsyncRace",JSON.stringify(n))}}getUpdatingCar(){const t=localStorage.getItem("AsyncRace");if(u(t)){const e=JSON.parse(t).currentUpdating;return console.log(e),e}}isRace(){const t=localStorage.getItem("AsyncRace");if(u(t))return JSON.parse(t).isRace}startRace(){const t=localStorage.getItem("AsyncRace");if(u(t)){const e=JSON.parse(t);e.isRace=!0,localStorage.setItem("AsyncRace",JSON.stringify(e))}}endRace(){const t=localStorage.getItem("AsyncRace");if(u(t)){const e=JSON.parse(t);e.isRace=!1,localStorage.setItem("AsyncRace",JSON.stringify(e))}}removeFinishers(){const t=localStorage.getItem("AsyncRace");if(u(t)){const e=JSON.parse(t);e.racersStack=[],localStorage.setItem("AsyncRace",JSON.stringify(e))}}addFinisher(t){const e=localStorage.getItem("AsyncRace");if(u(e)){const n=JSON.parse(e);n.racersStack.push(t),localStorage.setItem("AsyncRace",JSON.stringify(n))}}getWinnerLocalStorage(){const t=localStorage.getItem("AsyncRace");if(u(t))return JSON.parse(t).racersStack[0]}}class h{async getCars(t=1){try{return await(await fetch(`http://localhost:3000/garage?_page=${t}&_limit=7`)).json()}catch(e){console.log(e)}}async getAllCars(){try{return await(await fetch("http://localhost:3000/garage")).json()}catch(t){console.log(t)}}async getCar(t){try{return await(await fetch(`http://localhost:3000/garage/${t}`)).json()}catch(e){throw console.log(e),e}}async createCar(t,e){const n={name:t,color:e};if(u(n))try{return await fetch("http://localhost:3000/garage/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch(r){console.log(r)}}async deleteCar(t){try{return await fetch(`http://localhost:3000/garage/${t}`,{method:"DELETE"})}catch(e){console.log(e)}}async updateCar(t){const e={name:t.name,color:t.color};try{if(u(e)){const n=await fetch(`http://localhost:3000/garage/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});console.log(n)}}catch(n){console.log(n)}}async startStopEngine(t){if(u(t))try{return await(await fetch(`http://localhost:3000/engine?id=${t.id}&status=${t.status}`,{method:"PATCH"})).json()}catch(e){console.error(e)}}async drive(t){if(u(t))try{const e=await fetch(`http://localhost:3000/engine?id=${t}&status=drive`,{method:"PATCH"});if(!e.ok)throw new Error(e.statusText);return await e.json()}catch(e){throw new Error("API Error: "+e)}}async getWinners(t=1,e="id",n="ASC"){try{return await(await fetch(`http://localhost:3000/winners?_page=${t}&_limit=10&_sort=${e}&_order=${n}`)).json()}catch(r){console.log(r)}}async getAllWinners(){try{return await(await fetch("http://localhost:3000/winners")).json()}catch(t){console.log(t)}}async getWinner(t){try{const e=await fetch(`http://localhost:3000/winners/${t}`);if(!e.ok)throw console.log(e.statusText),new Error(e.statusText);return await e.json()}catch(e){throw new Error("API Error: "+e)}}async createWinner(t){if(u(t))try{return await fetch("http://localhost:3000/winners",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(e){console.log(e)}}async deleteWinner(t){try{return await fetch(`http://localhost:3000/winners/${t}`,{method:"DELETE"})}catch(e){console.log(e)}}async updateWinner(t,e){const n={wins:t.wins,time:t.time};try{u(n)&&await fetch(`http://localhost:3000/winners/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch(r){console.log(r)}}}class k{draw(){const t=new i({tag:"div",className:"cars-amount"});return this.updateCarAmount(),t}async updateCarAmount(){const t=(await new h().getAllCars()).length,e=document.querySelector(".cars-amount");d(e)&&(e.textContent=`Garage (${t})`)}}var J=Object.defineProperty,D=(s,t,e)=>t in s?J(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,G=(s,t,e)=>(D(s,typeof t!="symbol"?t+"":t,e),e);class T{constructor(t){G(this,"_color"),this._color=t}drawCar(){const t=new i({tag:"div",className:"car-container"});return t.getNode().appendChild(this.createSvg()),t}createSvg(){const t=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","use");return e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","./car.svg#car"),t.classList.add("car"),t.style.fill=this._color,t.append(e),t}}class W{draw(t){return new i({tag:"div",className:"car-block__button",text:t})}}class U extends W{drawRemoveButton(){const t=this.draw("REMOVE").getNode();return t.classList.add("remove-button"),t}}var K=Object.defineProperty,V=(s,t,e)=>t in s?K(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,X=(s,t,e)=>(V(s,typeof t!="symbol"?t+"":t,e),e);class z extends W{constructor(t){super(),X(this,"_id"),this._id=t}drawSelecetButton(){const t=this.draw("SELECT").getNode();return this.selectCar(t),t.classList.add("select-button"),t}selectCar(t){t.addEventListener("click",()=>{const e=document.querySelector(".update-input");e instanceof HTMLInputElement&&(e.disabled=!1,new f().setUpdatingCar(this._id),this.selectCurentBlock(t,"updating-block"))})}selectCurentBlock(t,e){document.querySelectorAll(".car-block").forEach(r=>{r.classList.remove(e)});const n=t.closest(".car-block");u(n)&&n.classList.add(e)}}class Q{drawStartButton(){const t=new i({tag:"button",className:"car-block__button",text:"A"}),e=t.getNode();return this.disableButton(e),e.classList.add("start-button"),t}disableButton(t){t.addEventListener("click",()=>{if(t instanceof HTMLButtonElement&&t.disabled===!1){const e=t.nextElementSibling;e instanceof HTMLButtonElement&&(new f().isRace()||(e.disabled=!1),e.disabled=!1,t.disabled=!0)}})}}class Y{drawStopButton(){const t=new i({tag:"button",className:"car-block__button",text:"B"}),e=t.getNode();return e.setAttribute("disabled",""),e.classList.add("stop-button"),this.disableButton(e),t}disableButton(t){t.addEventListener("click",()=>{if(t instanceof HTMLButtonElement){const e=t.previousElementSibling;e instanceof HTMLButtonElement&&(e.disabled=!1,t.disabled=!0)}})}}var Z=Object.defineProperty,tt=(s,t,e)=>t in s?Z(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,g=(s,t,e)=>(tt(s,typeof t!="symbol"?t+"":t,e),e);class S{constructor(t,e,n){g(this,"_name"),g(this,"_color"),g(this,"_id"),g(this,"_car"),g(this,"_carSectionNode"),g(this,"_parentCarBlock"),g(this,"_removeCarBlockFromArr"),g(this,"_winnerPage"),g(this,"startCarMovement",async(r,a)=>{const o=await new h().startStopEngine({id:r,status:"started"});await this.driveAnimation(o,a,this._car)}),g(this,"isCarEverWon",async()=>{try{return await new h().getWinner(this._id),!0}catch(r){if(r==="Not Found")return!1}}),g(this,"recordWin",async r=>{const a=await this.isCarEverWon(),o=new h;if(a){const c=await o.getWinner(this._id);console.log(c);const l=c.wins+1,m=c.time,p=r.time;m>p?await o.updateWinner({wins:l,time:p},this._id):await o.updateWinner({wins:l,time:m},this._id)}else{const c={id:this._id,wins:1,time:r.time};await o.createWinner(c)}await o.getAllWinners()}),g(this,"removeButtonClickListener",()=>{this.removeThisBlock()}),this._name=t.name,this._color=t.color,this._id=t.id,this._parentCarBlock=new i({tag:"div",className:"car-block"}),this._removeCarBlockFromArr=e,this._winnerPage=n}draw(){const t=this._parentCarBlock,e=t.getNode();return this.addButtonsBlock(t),this.addCarSection(t),e}addButtonsBlock(t){const e=new i({tag:"div",className:"car-block__buttons"}),n=e.getNode(),r=new i({tag:"div",className:"car-block__name",text:this._name}),a=new z(this._id).drawSelecetButton(),o=new U().drawRemoveButton();o.addEventListener("click",this.removeButtonClickListener),n.appendChild(a),n.appendChild(o),n.appendChild(r.getNode()),t.append(e)}addCarSection(t){const e=new i({tag:"div",className:"car-section"}),n=e.getNode();this._carSectionNode=n;const r=new Q().drawStartButton(),a=r.getNode();a.addEventListener("click",()=>{this.startCarMovement(this._id,n)});const o=new Y,c=o.drawStopButton();c.getNode().addEventListener("click",()=>{o.disableButton(a),this.stopCarMovement(this._id,this._car)}),e.append(r),e.append(c),this._car=new T(this._color).drawCar(),e.append(this._car),n.appendChild(this.addFlag()),t.append(e)}async driveAnimation(t,e,n){try{const r=t.distance/t.velocity/1e3,a=e.offsetWidth-80,o=n==null?void 0:n.getNode();if(d(o)&&(o.style.left=`${a}px`,o.style.transition=`left ${r}s linear`),await await new h().drive(this._id)){const c={finisher:this._id,time:r.toFixed(2),color:this._color},l=new f;l.isRace()&&(l.addFinisher(c),await this.showWinner(c))}}catch(r){if(r instanceof Error&&r.message==="API Error: Error: Internal Server Error"){const a=n==null?void 0:n.getNode();if(d(a)){const o=window.getComputedStyle(a).getPropertyValue("left");a.style.left=o,a.style.filter="blur(5px)",a.style.transition="left 0s linear"}}}}async stopCarMovement(t,e){await new h().startStopEngine({id:t,status:"stopped"});const n=e==null?void 0:e.getNode();d(n)&&(setTimeout(()=>n.style.filter="blur(0px)",1500),n.style.left="80px",n.style.transition="left 0s linear")}addFlag(){const t=new Image;return t.src="/red-flag.png",t.classList.add("car-block__flag"),t}async removeThisBlock(){console.log(this._removeCarBlockFromArr);const t=new h;await t.deleteCar(this._id),await t.deleteWinner(this._id),this._parentCarBlock.destroy(),this._removeCarBlockFromArr(this._id),new k().updateCarAmount(),await this._winnerPage.reloadWinnersBlock()}async showWinner(t){const e=document.querySelector(".winner-block");if(d(e)&&!e.textContent){const n=new h,r={id:this._id,time:Number(t.time)};this.recordWin(r);const a=`Winner: ${(await n.getCar(t.finisher)).name} (${t.time}s)!`;e.textContent=a,await this._winnerPage.reloadWinnersBlock("time","ASC")}}}class et{draw(){return new i({tag:"button",className:"generate-button",text:"GENERATE 100 CARS"})}}var nt=Object.defineProperty,rt=(s,t,e)=>t in s?nt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,N=(s,t,e)=>(rt(s,typeof t!="symbol"?t+"":t,e),e);class I{constructor(t,e,n){N(this,"_carBlocks"),N(this,"_winnerPage"),N(this,"_removeCarBlockFromArr"),this._carBlocks=t,this._removeCarBlockFromArr=e,this._winnerPage=n}draw(){const t=new i({tag:"div",className:"create-block"});return t.append(this.drawInput("create-input")),t.append(this.drawPalette("create-color-input")),t.append(this.drawCreateButton()),t}drawInput(t){const e=new i({tag:"input",className:t});return e.setAttribute("type","text"),e.setAttribute("required",""),e.setAttribute("minlength","1"),e.setAttribute("maxlength","20"),e}drawPalette(t){const e=new i({tag:"input",className:t});return e.setAttribute("type","color"),e.setAttribute("value","#ffffff"),e}drawCreateButton(){const t=new i({tag:"div",className:"create-button",text:"CREATE"});return this.createCar(t),t}createCar(t){t.getNode().addEventListener("click",async()=>{const e=document.querySelector(".create-input"),n=document.querySelector(".create-color-input");if(e instanceof HTMLInputElement&&n instanceof HTMLInputElement){const r=e.value,a=n.value;if(r.length>=1){const o=new h;await o.createCar(r,a);const c=await o.getCars(),l=c[c.length-1];this.addNewCarBlock(l),e.style.outline="",e.value=""}else e.style.outline="1px solid red"}})}addNewCarBlock(t){const e=document.querySelector(".cars-block");if(d(e)&&e.children.length<7){const n=new S(t,this._removeCarBlockFromArr,this._winnerPage);this._carBlocks.push(n),console.log(this._carBlocks);const r=n.draw();e.appendChild(r),new k().updateCarAmount()}}}var st=Object.defineProperty,at=(s,t,e)=>t in s?st(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,C=(s,t,e)=>(at(s,typeof t!="symbol"?t+"":t,e),e);class ot{constructor(t,e,n){C(this,"_carBlocks"),C(this,"_removeCarBlockFromArr"),C(this,"_winnerPage"),C(this,"updateCarInBlocksArr",r=>(this._carBlocks.map(a=>(a._id===r.id&&(a._name=r.name,a._color=r.color),a)),this._carBlocks=this._carBlocks.slice(),console.log(this._carBlocks),this._carBlocks)),this._carBlocks=t,this._removeCarBlockFromArr=e,this._winnerPage=n}draw(){const t=new i({tag:"div",className:"update-block"}),e=new I(this._carBlocks,this._removeCarBlockFromArr,this._winnerPage),n=e.drawInput("update-input");n.setAttribute("disabled",""),t.append(n);const r=e.drawPalette("update-color-input");return t.append(r),t.append(this.drawUpdateButton()),t}drawUpdateButton(){const t=new i({tag:"div",className:"update-button",text:"UPDATE"});return this.updateCar(t),t}updateCar(t){t.getNode().addEventListener("click",async()=>{const e=document.querySelector(".update-input"),n=document.querySelector(".update-color-input");if(e instanceof HTMLInputElement&&n instanceof HTMLInputElement){const r=e.value,a=n.value;if(!e.disabled)if(r.length>=1){const o=new f().getUpdatingCar();await new h().updateCar({name:r,color:a,id:o}),e.style.outline="",e.value="",e.disabled=!0,await this.getNewCarBlock(o)}else e.style.outline="1px solid red"}})}async getNewCarBlock(t){const e=await new h().getCar(t),n=document.querySelector(".updating-block");if(d(n)){const r=n.querySelector(".car"),a=n.querySelector(".car-block__name");console.log(e),u(r)&&d(a)&&(r.setAttribute("style",`fill: ${e.color};`),a.textContent=e.name),n.classList.remove("updating-block"),this.updateCarInBlocksArr(e)}}}var it=Object.defineProperty,ct=(s,t,e)=>t in s?it(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,L=(s,t,e)=>(ct(s,typeof t!="symbol"?t+"":t,e),e);class lt{constructor(t,e,n){L(this,"_carBlocks"),L(this,"_removeCarBlockFromArr"),L(this,"_winnerPage"),this._carBlocks=t,this._removeCarBlockFromArr=e,this._winnerPage=n}draw(){const t=new i({tag:"div",className:"inputs-block"}),e=new I(this._carBlocks,this._removeCarBlockFromArr,this._winnerPage).draw(),n=new ot(this._carBlocks,this._removeCarBlockFromArr,this._winnerPage).draw();return t.append(e),t.append(n),t}}class M{drawCounter(){const t=new i({tag:"div",className:"pagination-counter"}),e=t.getNode();return e.textContent="Page #1",t}drawPaginationButtonsBlock(t,e){const n=new i({tag:"div",className:"pagination-buttons"});n.appendChildren(e),t.append(n)}drawPrevButton(){const t=new i({tag:"button",className:"pagination-button",text:"prev"});return t.setAttribute("disabled",""),t}async drawNextButton(t){const e=new i({tag:"button",className:"pagination-button",text:"next"});return(await new h().getAllCars()).length<=t&&e.setAttribute("disabled",""),e}}class dt{draw(){const t=new i({tag:"button",className:"race-button",text:"RACE"});return this.disableButton(t.getNode()),t}disableButton(t){t.addEventListener("click",async()=>{t instanceof HTMLButtonElement&&(t.disabled=!0)})}}class ut{draw(){const t=new i({tag:"button",className:"restart-button",text:"RESTART"});return this.restart(t.getNode()),t}restart(t){t.addEventListener("click",()=>{const e=document.querySelector(".race-button");e instanceof HTMLButtonElement&&(e.disabled=!1),t instanceof HTMLButtonElement&&(t.disabled=!0)})}}var ht=Object.defineProperty,wt=(s,t,e)=>t in s?ht(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,P=(s,t,e)=>(wt(s,typeof t!="symbol"?t+"":t,e),e);class gt{constructor(t){P(this,"_carBlocks"),P(this,"_restartButton"),this._carBlocks=t}draw(){const t=new i({tag:"div",className:"race-block"}),e=new dt().draw();e.getNode().addEventListener("click",()=>{w(HTMLButtonElement,this._restartButton)&&(this._restartButton.disabled=!0);const o=this._carBlocks.map(c=>c.stopCarMovement(c._id,c._car));Promise.allSettled(o).then(()=>{this.startRace(this._carBlocks)}),setTimeout(()=>{u(this._restartButton)&&(this._restartButton.disabled=!0)},5e3)});const n=new ut().draw(),r=n.getNode();r instanceof HTMLButtonElement&&(this._restartButton=r);const a=this.drawWinnerBlock();return r.addEventListener("click",async()=>{this.restartGame(this._carBlocks),this.cleanWinnerBlock(a)}),t.appendChildren([e,n,a]),t}async restartGame(t){t.forEach(async e=>{await e.stopCarMovement(e._id,e._car)}),new f().endRace()}async startRace(t){const e=new f;e.startRace(),e.removeFinishers(),t.forEach(async n=>{u(n._carSectionNode)&&await n.startCarMovement(n._id,n._carSectionNode)})}drawWinnerBlock(){return new i({tag:"div",className:"winner-block"})}cleanWinnerBlock(t){const e=t.getNode();e.textContent!==""&&(e.innerText="")}}const mt=()=>{const s=["#ffffff","#FFAEBC","#A0E7E5","#B4F8C8","#FBE7C6","#74BDCB","#E7F2F8","#4EC33D","#353643","#F0C9B3"],t=Math.floor(Math.random()*s.length);return`${s[t]}`},pt=()=>{const s=["Tesla","Ford","Seat","Fiat","BMW","Chery","Lada","Dacia","KIA","Toyota"],t=["Compact","S","Comfort","Speed","Family","Off-road","4X4","Nitro","Basic","Gold"],e=Math.floor(Math.random()*s.length),n=Math.floor(Math.random()*t.length);return`${s[e]} ${t[n]}`},O=s=>new i({tag:"div",className:"page-name",text:s});var _t=Object.defineProperty,yt=(s,t,e)=>t in s?_t(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,_=(s,t,e)=>(yt(s,typeof t!="symbol"?t+"":t,e),e);class Bt{constructor(t,e){_(this,"_parentNode"),_(this,"_winnerPage"),_(this,"_carBlocksArr",[]),_(this,"_currentPage",1),_(this,"_carsBlock"),_(this,"prevButtonClickListener",()=>{this._currentPage-=1,this.cleanCarBlocks(),this.addCars(this._currentPage,this._carsBlock),this.updatePaginatinCounter();const n=document.querySelector(".prev-button");this._currentPage===1&&w(HTMLButtonElement,n)&&(n.disabled=!0);const r=document.querySelector(".next-button");w(HTMLButtonElement,r)&&(r.disabled=!1);const a=document.querySelector(".race-button");w(HTMLButtonElement,a)&&(a.disabled=!1)}),_(this,"nextButtonClickListener",async()=>{this._currentPage+=1,this.cleanCarBlocks(),this.addCars(this._currentPage,this._carsBlock),this.updatePaginatinCounter();const n=document.querySelector(".prev-button");if(w(HTMLButtonElement,n)&&(n.disabled=!1),await this.isLastCarPage()){const a=document.querySelector(".next-button");w(HTMLButtonElement,a)&&(a.disabled=!0)}const r=document.querySelector(".race-button");w(HTMLButtonElement,r)&&(r.disabled=!1)}),_(this,"generateButtonListener",async()=>{for(let r=0;r<100;r+=1){const a=pt(),o=mt();await this.generateCarData(a,o)}const n=document.querySelector(".next-button");w(HTMLButtonElement,n)&&(n.disabled=!1),await new k().updateCarAmount()}),_(this,"generateCarData",async(n,r)=>{const a=new h;await a.createCar(n,r);const o=await a.getAllCars(),c=o[o.length-1];console.log(c),this.addNewCarBlock(c)}),_(this,"addCars",async(n,r)=>{(await new h().getCars(n)).forEach(a=>{const o=new S(a,this.removeCarBlockFromArr,this._winnerPage),c=o.draw();this._carBlocksArr.push(o),r==null||r.appendChild(c)})}),_(this,"removeCarBlockFromArr",n=>{console.log(n),this._carBlocksArr=this._carBlocksArr.filter(r=>r._id!==n)}),this._parentNode=t,this._winnerPage=e}async draw(){const t=new i({tag:"div",className:"garage-page"}),e=O("GARAGE");t.append(e);const n=new lt(this._carBlocksArr,this.removeCarBlockFromArr,this._winnerPage).draw(),r=new et().draw();r.addListener("click",this.generateButtonListener),t.append(r);const a=new gt(this._carBlocksArr).draw(),o=new k().draw(),c=new M,l=c.drawCounter();t.appendChildren([n,a,o,l]);const m=t.getNode();this.addCarsBlock(m),this._parentNode.appendChild(m);const p=c.drawPrevButton();p.getNode().classList.add("prev-button"),p.addListener("click",this.prevButtonClickListener);const b=await c.drawNextButton(7);b.addListener("click",this.nextButtonClickListener),b.getNode().classList.add("next-button"),c.drawPaginationButtonsBlock(t,[p,b])}addNewCarBlock(t){var e,n;const r=(e=this._carsBlock)==null?void 0:e.children.length;if(u(r)&&r<7){const a=new S(t,this.removeCarBlockFromArr,this._winnerPage);this._carBlocksArr.push(a);const o=a.draw();(n=this._carsBlock)==null||n.appendChild(o)}}async isLastCarPage(){const t=(await new h().getAllCars()).length,e=this._currentPage*7;return!(t-e>0)}updatePaginatinCounter(){const t=document.querySelector(".pagination-counter");d(t)&&(t.textContent=`Page #${this._currentPage}`)}cleanCarBlocks(){var t;for(this._carBlocksArr.length=0;(t=this._carsBlock)!=null&&t.firstChild;)this._carsBlock.removeChild(this._carsBlock.firstChild)}async addCarsBlock(t){const e=new i({tag:"div",className:"cars-block"}).getNode();this._carsBlock=e,this==null||this.addCars(this._currentPage,e),t.appendChild(e)}}var ft=Object.defineProperty,bt=(s,t,e)=>t in s?ft(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,B=(s,t,e)=>(bt(s,typeof t!="symbol"?t+"":t,e),e);class Ct{constructor(t,e){B(this,"_winnerData"),B(this,"_currentNumber"),B(this,"draw",async()=>{const n=new i({tag:"div",className:"winner__block"}),r=this.addNumberBlock(),a=await this.addCarBlock(),o=await this.addNameBlock(),c=this.addWinsBlock(),l=this.addTimeBlock();return n.appendChildren([r,a,o,c,l]),n}),B(this,"addCarBlock",async()=>{const n=new i({tag:"div",className:"winner__item"}),r=await new h().getCar(this._winnerData.id),a=new T(r.color).drawCar();return a.getNode().style.position="relative",a.getNode().style.left="0",n.append(a),n}),B(this,"addNameBlock",async()=>{const n=new i({tag:"div",className:"winner__item"}),r=await new h().getCar(this._winnerData.id);return n.getNode().textContent=r.name,n}),B(this,"addWinsBlock",()=>{const n=new i({tag:"div",className:"winner__item"});return n.getNode().textContent=String(this._winnerData.wins),n}),B(this,"addTimeBlock",()=>{const n=new i({tag:"div",className:"winner__item"}),r=n.getNode();return r.textContent=String(this._winnerData.time),r.style.width="32%",n}),this._winnerData=t,this._currentNumber=e}addNumberBlock(){const t=new i({tag:"div",className:"winner__item"});return t.getNode().textContent=String(this._currentNumber+1),t}}class x{draw(){const t=new i({tag:"div",className:"winners-amount"});return this.updateWinnersAmount(),t}async updateWinnersAmount(){const t=(await new h().getAllWinners()).length,e=document.querySelector(".winners-amount");d(e)&&(e.textContent=`Winners (${t})`)}}class kt{draw(){const t=new i({tag:"div",className:"winners-header"}),e=this.addNumberBlock(),n=this.addCarBlock(),r=this.addNameBlock();return t.appendChildren([e,n,r]),t}addNumberBlock(){return new i({tag:"div",className:"winners-header__item",text:"Number"})}addCarBlock(){return new i({tag:"div",className:"winners-header__item",text:"Car"})}addNameBlock(){return new i({tag:"div",className:"winners-header__item",text:"Name"})}addWinsBlock(){return new i({tag:"div",className:"winners-header__item",text:"Wins"})}addTimesBlock(){const t=new i({tag:"div",className:"winners-header__item",text:"Best time (secounds)"});return t.getNode().classList.add("winners-header__time"),t}}var vt=Object.defineProperty,Nt=(s,t,e)=>t in s?vt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,y=(s,t,e)=>(Nt(s,typeof t!="symbol"?t+"":t,e),e);class Lt{constructor(t,e){y(this,"_parentNode"),y(this,"_currentPage",1),y(this,"_winnerItemsBlock"),y(this,"prevButtonClickListener",()=>{this._currentPage-=1,this.cleanWinnerItemsBlock(),d(this._winnerItemsBlock)&&this.addWinners(this._currentPage,this._winnerItemsBlock),this.updatePaginatinCounter();const n=document.querySelector(".winners-prev-button");this._currentPage===1&&w(HTMLButtonElement,n)&&(n.disabled=!0);const r=document.querySelector(".winners-next-button");w(HTMLButtonElement,r)&&(r.disabled=!1)}),y(this,"reloadWinnersBlock",async(n="id",r="DESC")=>{if(this.cleanWinnerItemsBlock(),await new x().updateWinnersAmount(),d(this._winnerItemsBlock)&&this.addWinners(this._currentPage,this._winnerItemsBlock,n,r),await this.isLastCarPage()){const a=document.querySelector(".winners-next-button");w(HTMLButtonElement,a)&&(a.disabled=!0)}}),y(this,"nextButtonClickListener",async()=>{this._currentPage+=1,this.cleanWinnerItemsBlock(),d(this._winnerItemsBlock)&&this.addWinners(this._currentPage,this._winnerItemsBlock),this.updatePaginatinCounter();const n=document.querySelector(".winners-prev-button");if(console.log(n),this._currentPage!==1&&w(HTMLButtonElement,n)&&(n.disabled=!1),await this.isLastCarPage()){const r=document.querySelector(".winners-next-button");w(HTMLButtonElement,r)&&(r.disabled=!0)}}),y(this,"addWinnersBlock",async n=>{const r=new i({tag:"div",className:"winners-block"}),a=new kt,o=a.draw();r.append(o);const c=a.addWinsBlock(),l=c.getNode(),m=a.addTimesBlock(),p=m.getNode(),b=this.addWinnerItemsBlock();o.appendChildren([c,m]),m.addListener("click",()=>this.sortByTimeslistener(p,l)),c.addListener("click",()=>this.sortByWinnerslistener(l,p)),r.append(b),n.append(r)}),y(this,"sortByWinnerslistener",(n,r)=>{r.classList.remove("sort-arrow-up"),r.classList.remove("sort-arrow-down"),n.classList.toggle("wins-desc"),n.classList.contains("wins-desc")?(this.reloadWinnersBlock("wins","DESC"),n.classList.add("sort-arrow-down"),n.classList.remove("sort-arrow-up")):(this.reloadWinnersBlock("wins","ASC"),n.classList.add("sort-arrow-up"),n.classList.remove("sort-arrow-down"))}),y(this,"sortByTimeslistener",(n,r)=>{n.classList.toggle("time-desc"),r.classList.remove("sort-arrow-up"),r.classList.remove("sort-arrow-down"),n.classList.contains("time-desc")?(this.reloadWinnersBlock("time","DESC"),n.classList.add("sort-arrow-down"),n.classList.remove("sort-arrow-up")):(this.reloadWinnersBlock("time","ASC"),n.classList.add("sort-arrow-up"),n.classList.remove("sort-arrow-down"))}),y(this,"addWinnerItemsBlock",()=>{const n=new i({tag:"div",className:"winner-items-block"}),r=n.getNode();return this._winnerItemsBlock=r,this.addWinners(this._currentPage,r),n}),y(this,"addWinners",async(n,r,a="id",o="ASC")=>{const c=await new h().getWinners(n,a,o);for(let l=0;l<c.length;l++){const m=c[l];if(d(r)){const p=await(await new Ct(m,l).draw()).getNode();r.appendChild(p)}}}),this._parentNode=t,this._currentPage=e}async draw(){const t=new i({tag:"div",className:"winners-page"}),e=t.getNode();this._parentNode.appendChild(e);const n=O("WINNERS"),r=new x().draw(),a=new M,o=a.drawCounter();o.getNode().classList.add("winners-pagination-couneter"),t.appendChildren([n,r,o]),this.addWinnersBlock(t);const c=a.drawPrevButton();c.getNode().classList.add("winners-prev-button"),c.addListener("click",this.prevButtonClickListener);const l=await a.drawNextButton(10);l.getNode().classList.add("winners-next-button"),l.addListener("click",this.nextButtonClickListener),a.drawPaginationButtonsBlock(t,[c,l])}cleanWinnerItemsBlock(){if(d(this._winnerItemsBlock))for(;this._winnerItemsBlock.firstChild;)this._winnerItemsBlock.removeChild(this._winnerItemsBlock.firstChild)}updatePaginatinCounter(){const t=document.querySelector(".winners-pagination-couneter");d(t)&&(t.textContent=`Page #${this._currentPage}`)}async isLastCarPage(){const t=(await new h().getAllWinners()).length,e=this._currentPage*10;return!(t-e>0)}}const St=1,At=new f;At.setInitial();const A=document.body,Et=new j(A);Et.draw();const R=new Lt(A,St);R.draw();const Pt=new Bt(A,R);Pt.draw();
