(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function e(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=e(r);fetch(r.href,o)}})();function u(a){return a!=null}function d(a){return a==null?!1:a instanceof HTMLElement}function h(a,t){return t instanceof a}var H=Object.defineProperty,J=(a,t,e)=>t in a?H(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,P=(a,t,e)=>(J(a,typeof t!="symbol"?t+"":t,e),e);class i{constructor({tag:t="div",className:e="",text:n=""},...r){P(this,"_children",[]),P(this,"_node",null);const o=document.createElement(t);o.className=e,o.textContent=n,this._node=o,r&&r.length>0&&this.appendChildren(r)}append(t){var e;this._children.push(t);const n=t.getNode();n&&((e=this._node)==null||e.appendChild(n))}appendChildren(t){t.forEach(e=>{this.append(e)})}getNode(){if(d(this._node))return this._node;throw new Error("Node is not an HTMLElement")}getChildren(){return this._children}setTextContent(t){u(this._node)&&(this._node.textContent=t)}setAttribute(t,e){var n;(n=this._node)==null||n.setAttribute(t,e)}removeAttribute(t){var e;(e=this._node)==null||e.removeAttribute(t)}toggleClass(t){var e;(e=this._node)==null||e.classList.toggle(t)}addListener(t,e){var n;(n=this._node)==null||n.addEventListener(t,e)}destroyChildren(){this._children.forEach(t=>{t.destroy()}),this._children.length=0}destroy(){var t;this.destroyChildren(),(t=this._node)==null||t.remove()}}var D=Object.defineProperty,q=(a,t,e)=>t in a?D(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,k=(a,t,e)=>(q(a,typeof t!="symbol"?t+"":t,e),e);class G{constructor(t,e){k(this,"_parentNode"),k(this,"_winnersPage"),k(this,"goToGarage",()=>{const n=document.querySelector(".winners-page");d(n)&&(n.style.position="absolute",n.style.zIndex="-2");const r=document.querySelector(".garage-page");d(r)&&(r.style.position="relative",r.style.zIndex="0")}),k(this,"goToWinners",async()=>{await this._winnersPage.reloadWinnersBlock();const n=document.querySelector(".garage-page");d(n)&&(n.style.position="absolute",n.style.zIndex="-2");const r=document.querySelector(".winners-page");d(r)&&(r.style.position="relative",r.style.zIndex="0")}),this._parentNode=t,this._winnersPage=e}draw(){const t=new i({tag:"header"}),e=this.drawGarageButton(),n=this.drawWinnersButton();n.addListener("click",()=>this.disableManager(n,e)),e.addListener("click",()=>this.disableManager(e,n)),t.appendChildren([e,n]);const r=t.getNode();return this._parentNode.appendChild(r),r}drawGarageButton(){const t=new i({tag:"button",className:"garage-button",text:"TO GARAGE"});return t.setAttribute("disabled",""),t.addListener("click",()=>this.goToGarage()),t}drawWinnersButton(){const t=new i({tag:"button",className:"winners-button",text:"TO WINNERS"});return t.addListener("click",()=>this.goToWinners()),t}disableManager(t,e){const n=t.getNode();h(HTMLButtonElement,n)&&(n.disabled=!0);const r=e.getNode();h(HTMLButtonElement,r)&&(r.disabled=!1)}}class C{setInitial(){localStorage.setItem("AsyncRace",JSON.stringify({isRace:!1,racersStack:[]}))}setUpdatingCar(t){const e=localStorage.getItem("AsyncRace");if(u(e)){const n=JSON.parse(e);n.currentUpdating=t,localStorage.setItem("AsyncRace",JSON.stringify(n))}}getUpdatingCar(){const t=localStorage.getItem("AsyncRace");if(u(t)){const n=JSON.parse(t).currentUpdating;return console.log(n),n}}isRace(){const t=localStorage.getItem("AsyncRace");if(u(t))return JSON.parse(t).isRace}startRace(){const t=localStorage.getItem("AsyncRace");if(u(t)){const e=JSON.parse(t);e.isRace=!0,localStorage.setItem("AsyncRace",JSON.stringify(e))}}endRace(){const t=localStorage.getItem("AsyncRace");if(u(t)){const e=JSON.parse(t);e.isRace=!1,localStorage.setItem("AsyncRace",JSON.stringify(e))}}removeFinishers(){const t=localStorage.getItem("AsyncRace");if(u(t)){const e=JSON.parse(t);e.racersStack=[],localStorage.setItem("AsyncRace",JSON.stringify(e))}}addFinisher(t){const e=localStorage.getItem("AsyncRace");if(u(e)){const n=JSON.parse(e);n.racersStack.push(t),localStorage.setItem("AsyncRace",JSON.stringify(n))}}getWinnerLocalStorage(){const t=localStorage.getItem("AsyncRace");if(u(t))return JSON.parse(t).racersStack[0]}}class p{async getCars(t=1){try{return await(await fetch(`http://localhost:3000/garage?_page=${t}&_limit=7`)).json()}catch(e){console.log(e)}}async getAllCars(){try{return await(await fetch("http://localhost:3000/garage")).json()}catch(t){console.log(t)}}async getCar(t){try{return await(await fetch(`http://localhost:3000/garage/${t}`)).json()}catch(e){throw console.log(e),e}}async createCar(t,e){const n={name:t,color:e};if(u(n))try{return await fetch("http://localhost:3000/garage/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch(r){console.log(r)}}async deleteCar(t){try{return await fetch(`http://localhost:3000/garage/${t}`,{method:"DELETE"})}catch(e){console.log(e)}}async updateCar(t){const e={name:t.name,color:t.color};try{if(u(e)){const n=await fetch(`http://localhost:3000/garage/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});console.log(n)}}catch(n){console.log(n)}}async startStopEngine(t){if(u(t))try{return await(await fetch(`http://localhost:3000/engine?id=${t.id}&status=${t.status}`,{method:"PATCH"})).json()}catch(e){console.error(e)}}async drive(t){if(u(t))try{const e=await fetch(`http://localhost:3000/engine?id=${t}&status=drive`,{method:"PATCH"});if(!e.ok)throw new Error(e.statusText);return await e.json()}catch(e){throw new Error("API Error: "+e)}}async getWinners(t=1,e="id",n="ASC"){try{return await(await fetch(`http://localhost:3000/winners?_page=${t}&_limit=10&_sort=${e}&_order=${n}`)).json()}catch(r){console.log(r)}}async getAllWinners(){try{return await(await fetch("http://localhost:3000/winners")).json()}catch(t){console.log(t)}}async getWinner(t){try{const e=await fetch(`http://localhost:3000/winners/${t}`);if(!e.ok)throw new Error(e.statusText);return await e.json()}catch(e){throw new Error("API Error: "+e)}}async createWinner(t){if(u(t))try{return await fetch("http://localhost:3000/winners",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(e){console.log(e)}}async deleteWinner(t){try{return await fetch(`http://localhost:3000/winners/${t}`,{method:"DELETE"})}catch(e){console.log(e)}}async updateWinner(t,e){const n={wins:t.wins,time:t.time};try{u(n)&&await fetch(`http://localhost:3000/winners/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}catch(r){console.log(r)}}}class y{draw(){const t=new i({tag:"div",className:"cars-amount"});return this.updateCarAmount(),t}async updateCarAmount(){const n=(await new p().getAllCars()).length,r=document.querySelector(".cars-amount");d(r)&&(r.textContent=`Garage (${n})`)}}const U=a=>{h(HTMLButtonElement,a)&&(a.disabled=!1)};var z=Object.defineProperty,V=(a,t,e)=>t in a?z(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,K=(a,t,e)=>(V(a,typeof t!="symbol"?t+"":t,e),e);class T{constructor(t){K(this,"_color"),this._color=t}drawCar(){const t=new i({tag:"div",className:"car-container"});return t.getNode().appendChild(this.createSvg()),t}createSvg(){const t=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","use");return e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","./car.svg#car"),t.classList.add("car"),t.style.fill=this._color,t.append(e),t}}class W{draw(t){return new i({tag:"div",className:"car-block__button",text:t})}}class X extends W{drawRemoveButton(){const e=this.draw("REMOVE").getNode();return e.classList.add("remove-button"),e}}var j=Object.defineProperty,Q=(a,t,e)=>t in a?j(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,Y=(a,t,e)=>(Q(a,typeof t!="symbol"?t+"":t,e),e);class Z extends W{constructor(t){super(),Y(this,"_id"),this._id=t}drawSelecetButton(){const e=this.draw("SELECT").getNode();return this.selectCar(e),e.classList.add("select-button"),e}selectCar(t){t.addEventListener("click",()=>{const e=document.querySelector(".update-input");e instanceof HTMLInputElement&&(e.disabled=!1,new C().setUpdatingCar(this._id),this.selectCurentBlock(t,"updating-block"))})}selectCurentBlock(t,e){document.querySelectorAll(".car-block").forEach(o=>{o.classList.remove(e)});const r=t.closest(".car-block");u(r)&&r.classList.add(e)}}class tt{drawStartButton(){const t=new i({tag:"button",className:"car-block__button",text:"A"}),e=t.getNode();return this.disableButton(e),e.classList.add("start-button"),t}disableButton(t){t.addEventListener("click",()=>{if(t instanceof HTMLButtonElement&&t.disabled===!1){const e=t.nextElementSibling;e instanceof HTMLButtonElement&&(new C().isRace()||(e.disabled=!1),e.disabled=!1,t.disabled=!0)}})}}class et{drawStopButton(){const t=new i({tag:"button",className:"car-block__button",text:"B"}),e=t.getNode();return e.setAttribute("disabled",""),e.classList.add("stop-button"),this.disableButton(e),t}disableButton(t){t.addEventListener("click",()=>{if(t instanceof HTMLButtonElement){const e=t.previousElementSibling;e instanceof HTMLButtonElement&&(e.disabled=!1,t.disabled=!0)}})}}var nt=Object.defineProperty,rt=(a,t,e)=>t in a?nt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,m=(a,t,e)=>(rt(a,typeof t!="symbol"?t+"":t,e),e);class A{constructor(t,e){m(this,"_name"),m(this,"_color"),m(this,"_id"),m(this,"_car"),m(this,"_carSectionNode"),m(this,"_parentCarBlock"),m(this,"_removeCarBlockFromArr"),m(this,"startCarMovement",async(n,r)=>{const s=await new p().startStopEngine({id:n,status:"started"});await this.driveAnimation(s,r,this._car)}),m(this,"isCarEverWon",async()=>{try{return await new p().getWinner(this._id),!0}catch(n){if(n==="Not Found")return!1}}),m(this,"recordWin",async n=>{const r=await this.isCarEverWon(),o=new p;if(r){const s=await o.getWinner(this._id);console.log(s);const c=s.wins+1,l=s.time,g=n.time;l>g?await o.updateWinner({wins:c,time:g},this._id):await o.updateWinner({wins:c,time:l},this._id)}else{const s={id:this._id,wins:1,time:n.time};await o.createWinner(s)}}),m(this,"removeButtonClickListener",()=>{this.removeThisBlock()}),this._name=t.name,this._color=t.color,this._id=t.id,this._parentCarBlock=new i({tag:"div",className:"car-block"}),this._removeCarBlockFromArr=e}draw(){const t=this._parentCarBlock,e=t.getNode();return this.addButtonsBlock(t),this.addCarSection(t),e}addButtonsBlock(t){const e=new i({tag:"div",className:"car-block__buttons"}),n=e.getNode(),r=new i({tag:"div",className:"car-block__name",text:this._name}),o=new Z(this._id).drawSelecetButton(),s=new X().drawRemoveButton();s.addEventListener("click",this.removeButtonClickListener),n.appendChild(o),n.appendChild(s),n.appendChild(r.getNode()),t.append(e)}addCarSection(t){const e=new i({tag:"div",className:"car-section"}),n=e.getNode();this._carSectionNode=n;const r=new tt().drawStartButton(),o=r.getNode();o.addEventListener("click",()=>{this.startCarMovement(this._id,n)});const s=new et,c=s.drawStopButton();c.getNode().addEventListener("click",()=>{s.disableButton(o),this.stopCarMovement(this._id,this._car)}),e.append(r),e.append(c),this._car=new T(this._color).drawCar(),e.append(this._car),n.appendChild(this.addFlag()),t.append(e)}async driveAnimation(t,e,n){try{const r=t.distance/t.velocity/1e3,o=e.offsetWidth-80,s=n==null?void 0:n.getNode();if(d(s)&&(s.style.left=`${o}px`,s.style.transition=`left ${r}s linear`),await await new p().drive(this._id)){const w={finisher:this._id,time:r.toFixed(2),color:this._color},f=new C;f.isRace()&&(f.addFinisher(w),await this.showWinner(w))}}catch(r){if(r instanceof Error&&r.message==="API Error: Error: Internal Server Error"){const o=n==null?void 0:n.getNode();if(d(o)){const s=window.getComputedStyle(o).getPropertyValue("left");o.style.left=s,o.style.filter="blur(5px)",o.style.transition="left 0s linear"}}}}async stopCarMovement(t,e){await new p().startStopEngine({id:t,status:"stopped"});const r=e==null?void 0:e.getNode();d(r)&&(setTimeout(()=>r.style.filter="blur(0px)",1500),r.style.left="80px",r.style.transition="left 0s linear")}addFlag(){const t=new Image;return t.src="./red-flag.png",t.classList.add("car-block__flag"),t}async removeThisBlock(){console.log(this._removeCarBlockFromArr);const t=new p;await t.deleteCar(this._id),await t.deleteWinner(this._id),this._parentCarBlock.destroy(),this._removeCarBlockFromArr(this._id),new y().updateCarAmount()}async showWinner(t){const e=document.querySelector(".winner-block");if(d(e)&&!e.textContent){const n=new p,r={id:this._id,time:Number(t.time)};console.log("record");const c=`Winner: ${(await n.getCar(t.finisher)).name} (${t.time}s)!`;e.textContent=c,await this.recordWin(r),this.enableToWinners()}}enableToWinners(){const t=document.querySelector(".winners-button");d(t)&&U(t)}}class at{draw(){return new i({tag:"button",className:"generate-button",text:"GENERATE 100 CARS"})}}var ot=Object.defineProperty,st=(a,t,e)=>t in a?ot(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,E=(a,t,e)=>(st(a,typeof t!="symbol"?t+"":t,e),e);class M{constructor(t,e){E(this,"_carBlocks"),E(this,"_removeCarBlockFromArr"),this._carBlocks=t,this._removeCarBlockFromArr=e}draw(){const t=new i({tag:"div",className:"create-block"});return t.append(this.drawInput("create-input")),t.append(this.drawPalette("create-color-input")),t.append(this.drawCreateButton()),t}drawInput(t){const e=new i({tag:"input",className:t});return e.setAttribute("type","text"),e.setAttribute("required",""),e.setAttribute("minlength","1"),e.setAttribute("maxlength","20"),e}drawPalette(t){const e=new i({tag:"input",className:t});return e.setAttribute("type","color"),e.setAttribute("value","#ffffff"),e}drawCreateButton(){const t=new i({tag:"div",className:"create-button",text:"CREATE"});return this.createCar(t),t}createCar(t){t.getNode().addEventListener("click",async()=>{const n=document.querySelector(".create-input"),r=document.querySelector(".create-color-input");if(n instanceof HTMLInputElement&&r instanceof HTMLInputElement){const o=n.value,s=r.value;if(o.length>=1){const c=new p;await c.createCar(o,s),await new y().updateCarAmount(),console.log("я тут");const g=await c.getCars(),w=g[g.length-1];this.addNewCarBlock(w),n.style.outline="",n.value=""}else n.style.outline="1px solid red"}})}async addNewCarBlock(t){const e=document.querySelector(".cars-block");if(d(e)&&e.children.length<7){const r=new A(t,this._removeCarBlockFromArr);this._carBlocks.push(r),console.log(this._carBlocks);const o=r.draw();e.appendChild(o)}}}var it=Object.defineProperty,ct=(a,t,e)=>t in a?it(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,S=(a,t,e)=>(ct(a,typeof t!="symbol"?t+"":t,e),e);class lt{constructor(t,e){S(this,"_carBlocks"),S(this,"_removeCarBlockFromArr"),S(this,"updateCarInBlocksArr",n=>(this._carBlocks.map(r=>(r._id===n.id&&(r._name=n.name,r._color=n.color),r)),this._carBlocks=this._carBlocks.slice(),this._carBlocks)),this._carBlocks=t,this._removeCarBlockFromArr=e}draw(){const t=new i({tag:"div",className:"update-block"}),e=new M(this._carBlocks,this._removeCarBlockFromArr),n=e.drawInput("update-input");n.setAttribute("disabled",""),t.append(n);const r=e.drawPalette("update-color-input");return t.append(r),t.append(this.drawUpdateButton()),t}drawUpdateButton(){const t=new i({tag:"div",className:"update-button",text:"UPDATE"});return this.updateCar(t),t}updateCar(t){t.getNode().addEventListener("click",async()=>{const n=document.querySelector(".update-input"),r=document.querySelector(".update-color-input");if(n instanceof HTMLInputElement&&r instanceof HTMLInputElement){const o=n.value,s=r.value;if(!n.disabled)if(o.length>=1){const l=new C().getUpdatingCar();await new p().updateCar({name:o,color:s,id:l}),n.style.outline="",n.value="",n.disabled=!0,await this.getNewCarBlock(l)}else n.style.outline="1px solid red"}})}async getNewCarBlock(t){const n=await new p().getCar(t),r=document.querySelector(".updating-block");if(d(r)){const o=r.querySelector(".car"),s=r.querySelector(".car-block__name");console.log(n),u(o)&&d(s)&&(o.setAttribute("style",`fill: ${n.color};`),s.textContent=n.name),r.classList.remove("updating-block"),this.updateCarInBlocksArr(n)}}}var dt=Object.defineProperty,ut=(a,t,e)=>t in a?dt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,x=(a,t,e)=>(ut(a,typeof t!="symbol"?t+"":t,e),e);class pt{constructor(t,e){x(this,"_carBlocks"),x(this,"_removeCarBlockFromArr"),this._carBlocks=t,this._removeCarBlockFromArr=e}draw(){const t=new i({tag:"div",className:"inputs-block"}),e=new M(this._carBlocks,this._removeCarBlockFromArr).draw(),n=new lt(this._carBlocks,this._removeCarBlockFromArr).draw();return t.append(e),t.append(n),t}}class O{drawCounter(t){const e=new i({tag:"div",className:t}),n=e.getNode();return n.textContent="Page #1",e}drawPaginationButtonsBlock(t,e){const n=new i({tag:"div",className:"pagination-buttons"});n.appendChildren(e),t.append(n)}drawPrevButton(){const t=new i({tag:"button",className:"pagination-button",text:"prev"});return t.setAttribute("disabled",""),t}async drawNextButton(t){const e=new i({tag:"button",className:"pagination-button",text:"next"});return(await new p().getAllCars()).length<=t&&e.setAttribute("disabled",""),e}}const ht=a=>{h(HTMLButtonElement,a)&&(a.disabled=!0)};class gt{draw(){const t=new i({tag:"button",className:"race-button",text:"RACE"});return this.disableButton(t.getNode()),t}disableButton(t){t.addEventListener("click",async()=>{t instanceof HTMLButtonElement&&(t.disabled=!0)})}}class wt{draw(){const t=new i({tag:"button",className:"restart-button",text:"RESTART"});return this.restart(t.getNode()),t}restart(t){t.addEventListener("click",()=>{const e=document.querySelector(".race-button");e instanceof HTMLButtonElement&&(e.disabled=!1),t instanceof HTMLButtonElement&&(t.disabled=!0)})}}var mt=Object.defineProperty,Bt=(a,t,e)=>t in a?mt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,v=(a,t,e)=>(Bt(a,typeof t!="symbol"?t+"":t,e),e);class _t{constructor(t){v(this,"_carBlocks"),v(this,"_restartButton"),v(this,"_winnnerResultBlock"),v(this,"raceButtonListener",async()=>{h(HTMLButtonElement,this._restartButton)&&(this._restartButton.disabled=!0);const e=this._carBlocks.map(n=>n.stopCarMovement(n._id,n._car));Promise.allSettled(e).then(()=>{this.startRace(this._carBlocks)}),this.disablePagination(),setTimeout(()=>{u(this._restartButton)&&(this._restartButton.disabled=!1)},6e3),this.disableToWinners()}),this._carBlocks=t}draw(){const t=new i({tag:"div",className:"race-block"}),e=new gt().draw();e.getNode().addEventListener("click",async()=>{await this.raceButtonListener()});const r=new wt().draw(),o=r.getNode();o instanceof HTMLButtonElement&&(this._restartButton=o);const s=this.drawWinnerBlock();return o.addEventListener("click",async()=>{this.restartGame(this._carBlocks),this.cleanWinnerBlock()}),t.appendChildren([e,r,s]),t}disablePagination(){const t=document.querySelector(".next-button"),e=document.querySelector(".prev-button");if(h(HTMLButtonElement,t)&&h(HTMLButtonElement,e)){const n=t.disabled,r=e.disabled;t.disabled=!0,e.disabled=!0,setTimeout(()=>{t.disabled=n,e.disabled=r},1e4)}}disableToWinners(){const t=document.querySelector(".winners-button");d(t)&&ht(t)}async restartGame(t){t.forEach(async n=>{await n.stopCarMovement(n._id,n._car)}),new C().endRace()}async startRace(t){const e=new C;e.startRace(),e.removeFinishers(),t.forEach(async n=>{u(n._carSectionNode)&&await n.startCarMovement(n._id,n._carSectionNode)})}drawWinnerBlock(){const t=new i({tag:"div",className:"winner-block"});return this._winnnerResultBlock=t.getNode(),t}cleanWinnerBlock(){this._winnnerResultBlock&&this._winnnerResultBlock.textContent!==""&&(this._winnnerResultBlock.innerText="")}}const ft=()=>{const a=["#ffffff","#FFAEBC","#A0E7E5","#B4F8C8","#FBE7C6","#74BDCB","#E7F2F8","#4EC33D","#353643","#F0C9B3"],t=Math.floor(Math.random()*a.length);return`${a[t]}`},bt=()=>{const a=["Tesla","Ford","Seat","Fiat","BMW","Chery","Lada","Dacia","KIA","Toyota"],t=["Compact","S","Comfort","Speed","Family","Off-road","4X4","Nitro","Basic","Gold"],e=Math.floor(Math.random()*a.length),n=Math.floor(Math.random()*t.length);return`${a[e]} ${t[n]}`},$=a=>new i({tag:"div",className:"page-name",text:a});var Ct=Object.defineProperty,Nt=(a,t,e)=>t in a?Ct(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,_=(a,t,e)=>(Nt(a,typeof t!="symbol"?t+"":t,e),e);class kt{constructor(t){_(this,"_parentNode"),_(this,"_carBlocksArr",[]),_(this,"_currentPage",1),_(this,"_carsBlock"),_(this,"prevButtonClickListener",e=>{this._currentPage-=1,this.cleanCarBlocks(),this.addCars(this._currentPage,this._carsBlock),this.updatePaginatinCounter();const n=document.querySelector(".prev-button");this._currentPage===1&&h(HTMLButtonElement,n)&&(n.disabled=!0);const r=document.querySelector(".next-button");h(HTMLButtonElement,r)&&(r.disabled=!1);const o=document.querySelector(".race-button");h(HTMLButtonElement,o)&&(o.disabled=!1),e.cleanWinnerBlock()}),_(this,"nextButtonClickListener",async e=>{this._currentPage+=1,this.cleanCarBlocks(),this.addCars(this._currentPage,this._carsBlock),this.updatePaginatinCounter();const n=document.querySelector(".prev-button");if(h(HTMLButtonElement,n)&&(n.disabled=!1),await this.isLastCarPage()){const s=document.querySelector(".next-button");h(HTMLButtonElement,s)&&(s.disabled=!0)}const o=document.querySelector(".race-button");h(HTMLButtonElement,o)&&(o.disabled=!1),e.cleanWinnerBlock()}),_(this,"generateButtonListener",async()=>{for(let r=0;r<100;r+=1){const o=bt(),s=ft();await this.generateCarData(o,s)}const e=document.querySelector(".next-button");h(HTMLButtonElement,e)&&(e.disabled=!1),await new y().updateCarAmount()}),_(this,"generateCarData",async(e,n)=>{const r=new p;await r.createCar(e,n);const o=await r.getAllCars(),s=o[o.length-1];console.log(s),this.addNewCarBlock(s)}),_(this,"addCars",async(e,n)=>{(await new p().getCars(e)).forEach(s=>{const c=new A(s,this.removeCarBlockFromArr),l=c.draw();this._carBlocksArr.push(c),n==null||n.appendChild(l)})}),_(this,"removeCarBlockFromArr",e=>{console.log(e),this._carBlocksArr=this._carBlocksArr.filter(n=>n._id!==e)}),this._parentNode=t}async draw(){const t=new i({tag:"div",className:"garage-page"}),e=$("GARAGE");t.append(e);const n=new pt(this._carBlocksArr,this.removeCarBlockFromArr).draw(),r=new at().draw();r.addListener("click",this.generateButtonListener),t.append(r);const o=new _t(this._carBlocksArr),s=o.draw(),c=new y().draw(),l=new O,g=l.drawCounter("pagination-counter");t.appendChildren([n,s,c,g]);const w=t.getNode();this.addCarsBlock(w),this._parentNode.appendChild(w);const f=l.drawPrevButton();f.getNode().classList.add("prev-button"),f.addListener("click",()=>this.prevButtonClickListener(o));const N=await l.drawNextButton(7);N.addListener("click",()=>this.nextButtonClickListener(o)),N.getNode().classList.add("next-button"),l.drawPaginationButtonsBlock(t,[f,N])}addNewCarBlock(t){var e,n;const r=(e=this._carsBlock)==null?void 0:e.children.length;if(u(r)&&r<7){const o=new A(t,this.removeCarBlockFromArr);this._carBlocksArr.push(o);const s=o.draw();(n=this._carsBlock)==null||n.appendChild(s)}}async isLastCarPage(){const n=(await new p().getAllCars()).length,r=this._currentPage*7;return!(n-r>0)}updatePaginatinCounter(){const t=document.querySelector(".pagination-counter");d(t)&&(t.textContent=`Page #${this._currentPage}`)}cleanCarBlocks(){var t;for(this._carBlocksArr.length=0;(t=this._carsBlock)!=null&&t.firstChild;)this._carsBlock.removeChild(this._carsBlock.firstChild)}async addCarsBlock(t){const n=new i({tag:"div",className:"cars-block"}).getNode();this._carsBlock=n,this==null||this.addCars(this._currentPage,n),t.appendChild(n)}}var vt=Object.defineProperty,yt=(a,t,e)=>t in a?vt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,b=(a,t,e)=>(yt(a,typeof t!="symbol"?t+"":t,e),e);class St{constructor(t,e){b(this,"_winnerData"),b(this,"_currentNumber"),b(this,"draw",async()=>{const n=new i({tag:"div",className:"winner__block"}),r=this.addNumberBlock(),o=await this.addCarBlock(),s=await this.addNameBlock(),c=this.addWinsBlock(),l=this.addTimeBlock();return n.appendChildren([r,o,s,c,l]),n}),b(this,"addCarBlock",async()=>{const n=new i({tag:"div",className:"winner__item"}),o=await new p().getCar(this._winnerData.id),s=new T(o.color).drawCar();return s.getNode().style.position="relative",s.getNode().style.left="0",n.append(s),n}),b(this,"addNameBlock",async()=>{const n=new i({tag:"div",className:"winner__item"}),o=await new p().getCar(this._winnerData.id);return n.getNode().textContent=o.name,n}),b(this,"addWinsBlock",()=>{const n=new i({tag:"div",className:"winner__item"});return n.getNode().textContent=String(this._winnerData.wins),n}),b(this,"addTimeBlock",()=>{const n=new i({tag:"div",className:"winner__item"}),r=n.getNode();return r.textContent=String(this._winnerData.time),r.style.width="32%",n}),this._winnerData=t,this._currentNumber=e}addNumberBlock(){const t=new i({tag:"div",className:"winner__item"});return t.getNode().textContent=String(this._currentNumber+1),t}}class I{draw(){const t=new i({tag:"div",className:"winners-amount"});return this.updateWinnersAmount(),t}async updateWinnersAmount(){const n=(await new p().getAllWinners()).length,r=document.querySelector(".winners-amount");d(r)&&(r.textContent=`Winners (${n})`)}}class At{draw(){const t=new i({tag:"div",className:"winners-header"}),e=this.addNumberBlock(),n=this.addCarBlock(),r=this.addNameBlock();return t.appendChildren([e,n,r]),t}addNumberBlock(){return new i({tag:"div",className:"winners-header__item",text:"Number"})}addCarBlock(){return new i({tag:"div",className:"winners-header__item",text:"Car"})}addNameBlock(){return new i({tag:"div",className:"winners-header__item",text:"Name"})}addWinsBlock(){return new i({tag:"div",className:"winners-header__item",text:"Wins"})}addTimesBlock(){const t=new i({tag:"div",className:"winners-header__item",text:"Best time (secounds)"});return t.getNode().classList.add("winners-header__time"),t}}var Lt=Object.defineProperty,Pt=(a,t,e)=>t in a?Lt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,B=(a,t,e)=>(Pt(a,typeof t!="symbol"?t+"":t,e),e);class Et{constructor(t,e){B(this,"_parentNode"),B(this,"_currentPage",1),B(this,"_winnerItemsBlock"),B(this,"prevButtonClickListener",()=>{this._currentPage-=1,this.cleanWinnerItemsBlock(),d(this._winnerItemsBlock)&&this.addWinners(this._currentPage,this._winnerItemsBlock),this.updatePaginatinCounter();const n=document.querySelector(".winners-prev-button");this._currentPage===1&&h(HTMLButtonElement,n)&&(n.disabled=!0);const r=document.querySelector(".winners-next-button");h(HTMLButtonElement,r)&&(r.disabled=!1)}),B(this,"reloadWinnersBlock",async(n="id",r="DESC")=>{if(this.cleanWinnerItemsBlock(),await new I().updateWinnersAmount(),d(this._winnerItemsBlock)&&this.addWinners(this._currentPage,this._winnerItemsBlock,n,r),await this.isLastCarPage()){const s=document.querySelector(".winners-next-button");h(HTMLButtonElement,s)&&(s.disabled=!0)}}),B(this,"nextButtonClickListener",async()=>{this._currentPage+=1,this.cleanWinnerItemsBlock(),d(this._winnerItemsBlock)&&this.addWinners(this._currentPage,this._winnerItemsBlock),this.updatePaginatinCounter();const n=document.querySelector(".winners-prev-button");if(console.log(n),this._currentPage!==1&&h(HTMLButtonElement,n)&&(n.disabled=!1),await this.isLastCarPage()){const o=document.querySelector(".winners-next-button");h(HTMLButtonElement,o)&&(o.disabled=!0)}}),B(this,"addWinnersBlock",async n=>{const r=new i({tag:"div",className:"winners-block"}),o=new At,s=o.draw();r.append(s);const c=o.addWinsBlock(),l=c.getNode(),g=o.addTimesBlock(),w=g.getNode(),f=this.addWinnerItemsBlock();s.appendChildren([c,g]),g.addListener("click",()=>this.sortByTimeslistener(w,l)),c.addListener("click",()=>this.sortByWinnerslistener(l,w)),r.append(f),n.append(r)}),B(this,"sortByWinnerslistener",(n,r)=>{r.classList.remove("sort-arrow-up"),r.classList.remove("sort-arrow-down"),n.classList.toggle("wins-desc"),n.classList.contains("wins-desc")?(this.reloadWinnersBlock("wins","DESC"),n.classList.add("sort-arrow-down"),n.classList.remove("sort-arrow-up")):(this.reloadWinnersBlock("wins","ASC"),n.classList.add("sort-arrow-up"),n.classList.remove("sort-arrow-down"))}),B(this,"sortByTimeslistener",(n,r)=>{n.classList.toggle("time-desc"),r.classList.remove("sort-arrow-up"),r.classList.remove("sort-arrow-down"),n.classList.contains("time-desc")?(this.reloadWinnersBlock("time","DESC"),n.classList.add("sort-arrow-down"),n.classList.remove("sort-arrow-up")):(this.reloadWinnersBlock("time","ASC"),n.classList.add("sort-arrow-up"),n.classList.remove("sort-arrow-down"))}),B(this,"addWinnerItemsBlock",()=>{const n=new i({tag:"div",className:"winner-items-block"}),r=n.getNode();return this._winnerItemsBlock=r,this.addWinners(this._currentPage,r),n}),B(this,"addWinners",async(n,r,o="id",s="ASC")=>{const l=await new p().getWinners(n,o,s);for(let g=0;g<l.length;g++){const w=l[g];if(d(r)){const F=await(await new St(w,g).draw()).getNode();r.appendChild(F)}}}),this._parentNode=t,this._currentPage=e}async draw(){const t=new i({tag:"div",className:"winners-page"}),e=t.getNode();this._parentNode.appendChild(e);const n=$("WINNERS"),r=new I().draw(),o=new O,s=o.drawCounter("winners-pagination-counter");s.getNode().classList.add("winners-pagination-couneter"),t.appendChildren([n,r,s]),this.addWinnersBlock(t);const c=o.drawPrevButton();c.getNode().classList.add("winners-prev-button"),c.addListener("click",this.prevButtonClickListener);const l=await o.drawNextButton(10);l.getNode().classList.add("winners-next-button"),l.addListener("click",this.nextButtonClickListener),o.drawPaginationButtonsBlock(t,[c,l])}cleanWinnerItemsBlock(){if(d(this._winnerItemsBlock))for(;this._winnerItemsBlock.firstChild;)this._winnerItemsBlock.removeChild(this._winnerItemsBlock.firstChild)}updatePaginatinCounter(){const t=document.querySelector(".winners-pagination-couneter");d(t)&&(t.textContent=`Page #${this._currentPage}`)}async isLastCarPage(){const n=(await new p().getAllWinners()).length,r=this._currentPage*10;return!(n-r>0)}}const xt=1,It=new C;It.setInitial();const L=document.body,R=new Et(L,xt),Tt=new G(L,R);Tt.draw();R.draw();const Wt=new kt(L);Wt.draw();
